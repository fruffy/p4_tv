--- before_pass
+++ after_pass
@@ -32,8 +32,8 @@ control MyComputeChecksum(inout my_packe
 control MyDeparser(packet_out b, in my_packet p) {
     apply {
         if (p.data[0].isValid()) {
-            b.emit(p.data);
+            b.emit<mpls[8]>(p.data);
         }
     }
 }
-V1Switch(MyParser(), MyVerifyChecksum(), MyIngress(), MyEgress(), MyComputeChecksum(), MyDeparser()) main;
+V1Switch<my_packet, my_metadata>(MyParser(), MyVerifyChecksum(), MyIngress(), MyEgress(), MyComputeChecksum(), MyDeparser()) main;
